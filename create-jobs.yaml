version: '3.6'

x-default: &node
  build:
    context: .
    dockerfile: build-sqoop.Dockerfile
  image: ${CCAO_REGISTRY_URL}/services/service_sqoop_iasworld:latest
  volumes:
    - ./drivers:/jdbc
    - ./scripts:/scripts
    - ./metastore:/root/.sqoop
  environment:
    - MASTER_HOSTNAME=sqoop-node-master
    - IPTS_HOSTNAME
    - IPTS_PORT
    - IPTS_SERVICE_NAME
    - IPTS_USERNAME
  secrets:
    - IPTS_PASSWORD
  networks:
    - hadoopnet

services:
  sqoop-node-master:
    <<: *node
    container_name: sqoop-node-master
    command: /bin/bash /scripts/create_jobs.sh

networks:
  hadoopnet:
    ipam:
      config:
        - subnet: 211.54.0.0/16
    name: hadoopnet

secrets:
  IPTS_PASSWORD:
    file: secrets/IPTS_PASSWORD
