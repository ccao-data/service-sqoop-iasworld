version: '3.6'

# Template for worker nodes
x-default: &node
  build: .
  image: sqoop:latest 
  volumes:
    - ./drivers:/jdbc # fsdfsd
    - ./scripts:/scripts
    - ./target:/tmp/target
    - ./metastore:/root/.sqoop
  environment:
    - MASTER_HOSTNAME=sqoop-node-master
    - NODE_HOSTNAMES=sqoop-node-2 sqoop-node-3 sqoop-node-4
    - IPTS_HOSTNAME
    - IPTS_PORT
    - IPTS_SERVICE_NAME
    - IPTS_USERNAME
  secrets:
    - IPTS_PASSWORD
  networks:
    - hadoopnet

# Main master node service
services:
  sqoop-node-master:
    <<: *node
    container_name: sqoop-node-master
    hostname: sqoop-node-master
    command: /scripts/run_jobs.sh
    ports:
      - 9870:9870
      - 9864:9864
      - 8080:8080
      - 8088:8088
      - 8042:8042

  sqoop-node-2:
    <<: *node
    container_name: sqoop-node-2
    command: tail -f /dev/null
    depends_on: 
      - sqoop-node-master

  sqoop-node-3:
    <<: *node
    container_name: sqoop-node-3
    command: tail -f /dev/null
    depends_on: 
      - sqoop-node-master

  sqoop-node-4:
    <<: *node
    container_name: sqoop-node-4
    command: tail -f /dev/null
    depends_on: 
      - sqoop-node-master

networks:
  hadoopnet:
    ipam:
      config:
        - subnet: 192.51.0.0/16
    name: hadoopnet

secrets:
  IPTS_PASSWORD:
    file: secrets/IPTS_PASSWORD
